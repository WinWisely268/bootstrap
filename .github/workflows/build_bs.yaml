# see: https://raw.githubusercontent.com/mtpereira/parede/fb38213a8dbdf98daffe35c895df14d05afe5e2b/.github/workflows/preview.yml

name: Bootstrap
on: [push]
jobs:
    build:
        name: Build Bootstrap
        runs-on: ${{ matrix.os }}
        strategy:
        matrix:
            os: [ubuntu-latest]
        steps:
        
        - name: Set up Go 1.13
        uses: actions/setup-go@v1
        with:
        go-version: 1.13
        id: go

        - name: Check out code into the Go module directory
            uses: actions/checkout@v2
        
        - name: Run Mage
            uses: crazy-max/ghaction-mage@v1
            with:
                version: latest
                args: -version

        - name: Build linux
            run: mage build:linux

        - name: "publish action-artifact zip"
            uses: actions/upload-artifact@v1
            with:
                name: linux
                path: ./bs
            
        - name: Build windows
            run: mage build:windows

        - name: "publish action-artifact zip"
            uses: actions/upload-artifact@v1
            with:
                name: win
                path: ./bs.exe
        
        - name: Build mac
            run: mage build:mac

        - name: "publish action-artifact zip"
            uses: actions/upload-artifact@v1
            with:
                name: mac
                path: ./bs

  release:
    needs: [build]
    name: Release Bootstrap
    runs-on: ubuntu-latest
    steps:
        - name: Check out code into the Go module directory
        uses: actions/checkout@v2

      - name: Download artefacts linux
        uses: actions/download-artifact@v1
        with:
          name: linux

      - name: Download artefacts linux
        uses: actions/download-artifact@v1
        with:
          name: mac
                  
        - name: Download artefacts Windows
        uses: actions/download-artifact@v1
        with:
        name: win

      - name: zip
        run: |
         zip bootstrap linux/bs mac/bs win/bs.exe
         
      - name: Create Release
        id: create_release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: ${{ github.ref }}
          release_name: Release ${{ github.ref }}
          draft: false
          prerelease: false

      - name: Upload Release Asset
        id: upload-release-asset 
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          upload_url: ${{ steps.create_release.outputs.upload_url }}
          asset_path: ./bootstrap.zip
          asset_name: bootstrap.zip
          asset_content_type: application/zip


      
